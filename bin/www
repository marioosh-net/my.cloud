#!/usr/bin/env node
var debug = require('debug')('websafe');
var app = require('../app');
var config = require('../config.js');
const fs = require('fs');

app.set('port', process.env.PORT || 3000);

const options = {
  key: fs.readFileSync(config.tls.key),
  cert: fs.readFileSync(config.tls.cert)
};

var server = require('https').createServer(options, app).listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
  
  var io = require('socket.io').listen(server);
  app.set('io',io);
  debug('Socket IO On');
  io.sockets.on('connection', function (socket) {
	  socket.on('disconnect', function () {
	    io.sockets.emit('user disconnected');
	  });
  });

});